@namespace JiiLib.Components
@using JiiLib.Collections.DiffList
@using JiiLib.Components.Diff

@if (DiffList is null) { }
else
{
    var style = Provider?.GetStyle<IDiffTableStyle>() ?? IDiffTableStyle.Default;
    <table class="diff-table @style.TableClass">
        <thead>
            <tr class="diff-table-title @style.TitleClass">
                <th colspan="3" style="text-align: center">@Title</th>
            </tr>
        </thead>
        <tbody class="diff-table-content @style.TableContentClass">
            @foreach (var (key, o, n, ds) in DiffList)
            {
                if (ds != DiffState.NonExistent)
                {
                    <tr class="@GetDiffClass(ds)">
                        <td class="item-key @style.ItemKeyClass">
                            @key
                        </td>
                        <td class="old-item @style.OldEntryClass">
                            <DiffValueCell DValue="o"/>
                        </td>
                        <td class="new-item @style.NewEntryClass">
                            <DiffValueCell DValue="n"/>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
}

@code
{
    /// <summary>
    ///     Sets the list of content that this table is to display
    /// </summary>
    [Parameter] public KeyedDiffList<string>? DiffList { private get; set; }

    /// <summary>
    ///     Sets the title to display in the table header.
    /// </summary>
    [Parameter] public string Title { private get; set; } = "";

    [CascadingParameter] public StyleProvider? Provider { private get; set; }

    private static string GetDiffClass(DiffState diffState)
        => diffState switch
        {
            DiffState.New     => "diff-new",
            DiffState.Changed => "diff-changed",
            DiffState.Removed => "diff-removed",
            _ => "diff-unchanged"
        };
}
